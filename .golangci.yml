run:
  # timeout for analysis
  deadline: 10m

  # Skip autogenerated files for mobile and gRPC.
  skip-files:
    - "mobile\\/.*generated\\.go"
    - "\\.pb\\.go$"
    - "\\.pb\\.gw\\.go$"

  skip-dirs:
    - channeldb/migration_01_to_11
    - channeldb/migration/lnwire21

  build-tags:
    - autopilotrpc
    - chainrpc
    - dev
    - invoicesrpc
    - neutrinorpc
    - peersrpc
    - signrpc
    - walletrpc
    - watchtowerrpc
    - kvdb_etcd
    - kvdb_postgres

linters-settings:
  govet:
    # Don't report about shadowed variables
    check-shadowing: false
  gofmt:
    # simplify code: gofmt with `-s` option, true by default
    simplify: true
  tagliatelle:
    case:
      rules:
        json: snake
  whitespace:
    multi-func: true
    multi-if: true
  gosec:
    excludes:
      - G402 # Look for bad TLS connection settings.
      - G306 # Poor file permissions used when writing to a new file.
  staticcheck: 
    go: "1.18"
    checks: ["-SA1019"]

  lll:
    # Max line length, lines longer will be reported.
    line-length: 80
    # Tab width in spaces.
    tab-width: 8

  funlen:
    # Checks the number of lines in a function.
    # If lower than 0, disable the check.
    # Default: 60
    lines: 60 
    # Checks the number of statements in a function.
    # Default: 40
    statements: 40


linters:
  enable-all: true
  disable:
  # Global variables are used in many places throughout the code base.
  - gochecknoglobals

  # We want to allow short variable names.
  - varnamelen

  # We want to allow TODOs.
  - godox

  # Instances of table driven tests that don't pre-allocate shouldn't trigger
  # the linter.
  - prealloc

  # Init functions are used by loggers throughout the codebase.
  - gochecknoinits
  
  # Deprecated linters. See https://golangci-lint.run/usage/linters/.
  - interfacer
  - golint
  - maligned
  - scopelint
  - exhaustivestruct
  - bodyclose
  - contextcheck
  - nilerr
  - noctx
  - rowserrcheck
  - sqlclosecheck
  - structcheck
  - tparallel
  - unparam
  - wastedassign
  
issues:
  # Only show newly introduced problems.
  new-from-rev: 8c66353e4c02329abdacb5a8df29998035ec2e24

  exclude-rules:
    # Exclude gosec from running for tests so that tests with weak randomness
    # (math/rand) will pass the linter.
    - path: _test\.go
      linters:
        - gosec
        - funlen
    - path: test*
      linters:
        - gosec
        - funlen

    # Allow duplicated code and fmt.Printf() in DB migrations.
    - path: channeldb/migration*
      linters:
        - dupl
        - forbidigo
        - godot

    # Allow duplicated code and fmt.Printf() in DB migration tests.
    - path: channeldb/migtest
      linters:
        - dupl
        - forbidigo
        - godot

    # Allow fmt.Printf() in lncli.
    - path: cmd/lncli/*
      linters:
        - forbidigo

    # Allow fmt.Printf() in config parsing.
    - path: config\.go
      linters:
        - forbidigo
    - path: lnd\.go
      linters:
        - forbidigo

    # Fix false positives because of build flags in itest directory.
    - path: lntest/itest/.*
      linters:
        - unused
        - deadcode
        - unparam
        - govet
        # itest case can be very long so we disable long function check.
        - funlen
